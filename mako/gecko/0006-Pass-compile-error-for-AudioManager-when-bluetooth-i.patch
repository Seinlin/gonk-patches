From ff59434a6ef10d3973250dd37b81c3e1ea2bf157 Mon Sep 17 00:00:00 2001
From: Kai-Zhen Li <kli@mozilla.com>
Date: Thu, 5 Dec 2013 14:42:20 +0800
Subject: [PATCH 6/8] Pass compile error for AudioManager when bluetooth is
 not enabled

---
 dom/system/gonk/AudioManager.cpp |   17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/dom/system/gonk/AudioManager.cpp b/dom/system/gonk/AudioManager.cpp
index df125b9..3c10e4a 100644
--- a/dom/system/gonk/AudioManager.cpp
+++ b/dom/system/gonk/AudioManager.cpp
@@ -28,9 +28,12 @@
 #include "mozilla/Services.h"
 #include "base/message_loop.h"
 
+// Todo kitkat
+#ifdef MOZ_B2G_BT
 #include "BluetoothCommon.h"
 #include "BluetoothProfileManagerBase.h"
 #include "BluetoothHfpManager.h"
+#endif
 
 #include "nsJSUtils.h"
 #include "nsCxPusher.h"
@@ -42,7 +45,10 @@ using namespace mozilla::dom::gonk;
 using namespace android;
 using namespace mozilla::hal;
 using namespace mozilla;
+// Todo kitkat
+#ifdef MOZ_B2G_BT
 using namespace mozilla::dom::bluetooth;
+#endif
 
 #define LOG(args...)  __android_log_print(ANDROID_LOG_INFO, "AudioManager" , ## args)
 
@@ -281,6 +287,7 @@ AudioManager::Observe(nsISupports* aSubject,
                       const char* aTopic,
                       const PRUnichar* aData)
 {
+#ifdef MOZ_B2G_BT
   if ((strcmp(aTopic, BLUETOOTH_SCO_STATUS_CHANGED_ID) == 0) ||
       (strcmp(aTopic, BLUETOOTH_HFP_STATUS_CHANGED_ID) == 0) ||
       (strcmp(aTopic, BLUETOOTH_A2DP_STATUS_CHANGED_ID) == 0)) {
@@ -296,7 +303,9 @@ AudioManager::Observe(nsISupports* aSubject,
 
   // To process the volume control on each audio channel according to
   // change of settings
-  else if (!strcmp(aTopic, MOZ_SETTINGS_CHANGE_ID)) {
+  else 
+#endif
+  if (!strcmp(aTopic, MOZ_SETTINGS_CHANGE_ID)) {
     AutoSafeJSContext cx;
     nsDependentString dataStr(aData);
     JS::Rooted<JS::Value> val(cx);
@@ -410,6 +419,8 @@ AudioManager::AudioManager() : mPhoneState(PHONE_STATE_CURRENT),
 
   nsCOMPtr<nsIObserverService> obs = services::GetObserverService();
   NS_ENSURE_TRUE_VOID(obs);
+// Todo kitkat
+#ifdef MOZ_B2G_BT
   if (NS_FAILED(obs->AddObserver(this, BLUETOOTH_SCO_STATUS_CHANGED_ID, false))) {
     NS_WARNING("Failed to add bluetooth sco status changed observer!");
   }
@@ -419,6 +430,7 @@ AudioManager::AudioManager() : mPhoneState(PHONE_STATE_CURRENT),
   if (NS_FAILED(obs->AddObserver(this, BLUETOOTH_HFP_STATUS_CHANGED_ID, false))) {
     NS_WARNING("Failed to add bluetooth hfp status changed observer!");
   }
+#endif
   if (NS_FAILED(obs->AddObserver(this, MOZ_SETTINGS_CHANGE_ID, false))) {
     NS_WARNING("Failed to add mozsettings-changed observer!");
   }
@@ -435,6 +447,8 @@ AudioManager::~AudioManager() {
 
   nsCOMPtr<nsIObserverService> obs = services::GetObserverService();
   NS_ENSURE_TRUE_VOID(obs);
+// Todo kitkat
+#ifdef MOZ_B2G_BT
   if (NS_FAILED(obs->RemoveObserver(this, BLUETOOTH_SCO_STATUS_CHANGED_ID))) {
     NS_WARNING("Failed to remove bluetooth sco status changed observer!");
   }
@@ -444,6 +458,7 @@ AudioManager::~AudioManager() {
   if (NS_FAILED(obs->RemoveObserver(this, BLUETOOTH_HFP_STATUS_CHANGED_ID))) {
     NS_WARNING("Failed to remove bluetooth hfp status changed observer!");
   }
+#endif
   if (NS_FAILED(obs->RemoveObserver(this, MOZ_SETTINGS_CHANGE_ID))) {
     NS_WARNING("Failed to remove mozsettings-changed observer!");
   }
-- 
1.7.9.5


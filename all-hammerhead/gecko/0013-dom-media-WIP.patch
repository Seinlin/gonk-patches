From a409f8aeb41dfd159b976994ce9bc5633c43187b Mon Sep 17 00:00:00 2001
From: Kai-Zhen Li <kli@mozilla.com>
Date: Wed, 29 Oct 2014 17:00:05 +0800
Subject: [PATCH 13/13] dom/media WIP.

---
 dom/media/encoder/fmp4_muxer/MuxerOperation.h | 3 ++-
 dom/media/omx/MediaCodecReader.h              | 2 +-
 dom/media/omx/OMXCodecWrapper.h               | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/dom/media/encoder/fmp4_muxer/MuxerOperation.h b/dom/media/encoder/fmp4_muxer/MuxerOperation.h
index aa6361a..1c1cf40 100644
--- a/dom/media/encoder/fmp4_muxer/MuxerOperation.h
+++ b/dom/media/encoder/fmp4_muxer/MuxerOperation.h
@@ -48,7 +48,8 @@ public:
   // list if exists. It can't look parent boxes.
   virtual nsresult Find(const nsACString& aType,
                         nsTArray<nsRefPtr<MuxerOperation>>& aOperations) = 0;
-
+//private:
+protected:
   virtual ~MuxerOperation() {}
 };
 
diff --git a/dom/media/omx/MediaCodecReader.h b/dom/media/omx/MediaCodecReader.h
index be7aef5..77b39d2 100644
--- a/dom/media/omx/MediaCodecReader.h
+++ b/dom/media/omx/MediaCodecReader.h
@@ -258,11 +258,11 @@ private:
     NS_INLINE_DECL_THREADSAFE_REFCOUNTING(SignalObject)
 
     SignalObject(const char* aName);
-    ~SignalObject();
     void Wait();
     void Signal();
 
   private:
+    ~SignalObject();
     // Forbidden
     SignalObject() MOZ_DELETE;
     SignalObject(const SignalObject &rhs) MOZ_DELETE;
diff --git a/dom/media/omx/OMXCodecWrapper.h b/dom/media/omx/OMXCodecWrapper.h
index 2ea835b..ecde70d 100644
--- a/dom/media/omx/OMXCodecWrapper.h
+++ b/dom/media/omx/OMXCodecWrapper.h
@@ -277,7 +277,7 @@ private:
  */
 class OMXVideoEncoder MOZ_FINAL : public OMXCodecWrapper
 {
-  NS_INLINE_DECL_THREADSAFE_REFCOUNTING(OMXVideoEncoder)
+  //NS_INLINE_DECL_THREADSAFE_REFCOUNTING(OMXVideoEncoder)
 public:
   // Types of output blob format.
   enum BlobFormat {
-- 
1.9.1


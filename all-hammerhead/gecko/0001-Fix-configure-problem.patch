From 0784aee5a58fb36d8eedf272727f2c4c48e50743 Mon Sep 17 00:00:00 2001
From: Kai-Zhen Li <kli@mozilla.com>
Date: Tue, 28 Oct 2014 10:24:39 +0800
Subject: [PATCH 1/3] Fix configure problem.

---
 configure.in        | 7 ++++---
 js/src/configure.in | 8 ++++----
 2 files changed, 8 insertions(+), 7 deletions(-)

diff --git a/configure.in b/configure.in
index 1ca411e..191d8be 100644
--- a/configure.in
+++ b/configure.in
@@ -233,10 +233,10 @@ if test -n "$gonkdir" ; then
 
     case "$target_cpu" in
     arm)
-        ARCH_DIR=arch-arm
+        ARCH_DIR=arm
         ;;
     i?86)
-        ARCH_DIR=arch-x86
+        ARCH_DIR=x86
         ;;
     esac
 
@@ -291,7 +291,8 @@ if test -n "$gonkdir" ; then
         AC_MSG_ERROR([Unsupported platform version: $ANDROID_VERSION])
         ;;
     esac
-    CPPFLAGS="-DANDROID -isystem $gonkdir/bionic/libc/$ARCH_DIR/include -isystem $gonkdir/bionic/libc/include/ -isystem $gonkdir/bionic/libc/kernel/common -isystem $gonkdir/bionic/libc/kernel/$ARCH_DIR -isystem $gonkdir/bionic/libm/include -I$gonkdir/system -I$gonkdir/system/core/include -isystem $gonkdir/bionic -I$gonkdir/hardware/libhardware/include -I$gonkdir/external/valgrind/fxos-include $GONK_INCLUDES $CPPFLAGS"
+
+    CPPFLAGS="-DANDROID -isystem $gonkdir/bionic/libc/arch-$ARCH_DIR/include -isystem $gonkdir/bionic/libc/include/ -isystem $gonkdir/bionic/libc/kernel/uapi -isystem $gonkdir/bionic/libc/kernel/uapi/asm-$ARCH_DIR -isystem $gonkdir/bionic/libm/include -I$gonkdir/system -I$gonkdir/system/core/include -isystem $gonkdir/bionic -I$gonkdir/hardware/libhardware/include -I$gonkdir/external/valgrind/fxos-include $GONK_INCLUDES $CPPFLAGS"
     CFLAGS="-mandroid -fno-short-enums -fno-exceptions $CFLAGS"
     CXXFLAGS="-mandroid -fno-short-enums -fno-exceptions -Wno-psabi $CXXFLAGS $STLPORT_CPPFLAGS"
     dnl Add -llog by default, since we use it all over the place.
diff --git a/js/src/configure.in b/js/src/configure.in
index a9e758e..c87e89d 100644
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -207,17 +207,17 @@ if test -n "$gonkdir" ; then
 
     case "$target_cpu" in
     arm)
-        ARCH_DIR=arch-arm
+        ARCH_DIR=arm
         ;;
     i?86)
-        ARCH_DIR=arch-x86
+        ARCH_DIR=x86
         ;;
     mips*)
-        ARCH_DIR=arch-mips
+        ARCH_DIR=mips
         ;;
     esac
 
-    CPPFLAGS="-DANDROID -isystem $gonkdir/bionic/libc/$ARCH_DIR/include -isystem $gonkdir/bionic/libc/include/ -isystem $gonkdir/bionic/libc/kernel/common -isystem $gonkdir/bionic/libc/kernel/$ARCH_DIR -isystem $gonkdir/bionic/libm/include -I$gonkdir/frameworks/base/native/include -I$gonkdir/system/core/include -isystem $gonkdir/bionic $CPPFLAGS -I$gonkdir/external/valgrind/fxos-include"
+    CPPFLAGS="-DANDROID -isystem $gonkdir/bionic/libc/arch-$ARCH_DIR/include -isystem $gonkdir/bionic/libc/include/ -isystem $gonkdir/bionic/libc/kernel/uapi -isystem $gonkdir/bionic/libc/kernel/uapi/asm-$ARCH_DIR -isystem $gonkdir/bionic/libm/include -I$gonkdir/frameworks/base/native/include -I$gonkdir/system/core/include -isystem $gonkdir/bionic $CPPFLAGS -I$gonkdir/external/valgrind/fxos-include"
     CFLAGS="-mandroid -fno-short-enums -fno-exceptions $CFLAGS"
     CXXFLAGS="-mandroid -fno-short-enums -fno-exceptions -Wno-psabi $CXXFLAGS $STLPORT_CPPFLAGS"
     LIBS="$LIBS $STLPORT_LIBS"
-- 
1.9.1

